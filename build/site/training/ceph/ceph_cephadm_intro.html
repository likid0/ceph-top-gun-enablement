<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The Cephadm Orchestrator :: Ceph Top Gun Enablement</title>
    <link rel="canonical" href="https://likid0.github.io/ceph-top-gun-enablement/training/ceph/ceph_cephadm_intro.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">
          <img src="../../_/img/header_logo_reverse.svg" height="48px" alt="Ceph">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Get Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage" target="_blank">Ceph Documentation</a>
            <a class="navbar-item" href="https://bugzilla.redhat.com/describecomponents.cgi?product=Red%20Hat%20OpenShift%20Container%20Storage" target="_blank">Browse Bugs</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Improve Guides</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/issues/new/choose" target="_blank">Open Issue</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Infos</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/en/blog/channel/red-hat-storage" target="_blank">Our Blog</a>
            <a class="navbar-item" href="https://www.youtube.com/channel/UCoyG8VyvB-XUxQl1mD3T3Gw" target="_blank">Youtube</a>
            <a class="navbar-item" href="https://docs.ceph.com/en/latest/" target="_blank">OCS Technology</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="training" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Ceph Top-Gun Enablement</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="opentlc_lab_env.html">Opentlc Lab Env</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Ceph</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_introduction.html">Ceph Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_architecture.html">Ceph Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_cluster_partitioning.html">Ceph Cluster Partitioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ceph_deployment_intro.html">Ceph Deployment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="ceph_cephadm_intro.html">Cephadm Orchestrator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph RadosGW</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_intro.html">RGW Introduction &amp; Deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_arch_deep_dive.html">RGW Deep Dive</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ha.html">RGW High Availability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_ssl.html">RGW &amp; Ingress with SSL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_users_quotas.html">RGW Users &amp; Quotas</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_auth.html">RGW Auth &amp; Authz</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_object_versioning.html">RGW S3 Object Versioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_placement_and_storage_classes.html">RGW Placement &amp; Storage Classes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_life_cycle_management.html">RGW Life Cycle Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_bucket_policy.html">RGW S3 Bucket Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_introduction.html">RGW Secure Token Service</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_sts_bucket_role_policy.html">RGW Bucket vs Role Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_multisite.html">RGW Multisite Replication</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_cloudsync.html">RGW Object Cloud Transition</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="radosgw_presignedurl.html">RGW presigned URL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">CephFS Shared FileSystem</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cephfs_intro.html">CephFS introduction &amp; Deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="trouble-shooting-nearfull-osds.html">Troubleshooting nearfull OSDs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ceph Stretched</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rhcs-stretched-deploy.html">Ceph Stretch Mode</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ceph Top-Gun Enablement</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Ceph Top-Gun Enablement</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Ceph Top-Gun Enablement</a></li>
    <li>Core Ceph</li>
    <li><a href="ceph_cephadm_intro.html">Cephadm Orchestrator</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///antora/training/modules/ceph/pages/ceph_cephadm_intro.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">The Cephadm Orchestrator</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the new tool for deploying Ceph starting with Ceph Octopus. Starting with Ceph Pacific
<code>ceph-ansible</code> is being deprecated and all new clusters will be deployed using it.</p>
</div>
<div class="paragraph">
<p>To deploy a cluster using <code>cephadm</code>, the following steps will be performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bootstrap a minimal cluster (1 Monitor and 1 Manager by default)</p>
</li>
<li>
<p>Configure the minimal cluster</p>
<div class="ulist">
<ul>
<li>
<p>Add Monitors</p>
</li>
<li>
<p>Add Managers</p>
</li>
<li>
<p>Add OSDs</p>
</li>
<li>
<p>Add MDSs</p>
</li>
<li>
<p>Add RGWs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cephadm_service_file"><a class="anchor" href="#_cephadm_service_file"></a><code>cephadm</code> service file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The initial cluster can be deployed with all its component through the use of a <code>cephadm</code> service file.
The service file uses the following syntax:</p>
</div>
<div class="listingblock">
<div class="title">Service file syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: {type_value}
service_name: {name_value}
addr: {address_value}
hostname: {hostname}
{options}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>service_type</code> accepts the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>host</code> to declare cluster hosts</p>
</li>
<li>
<p><code>crash</code> to place the Ceph crash collection module</p>
</li>
<li>
<p><code>grafana</code> to place the Grafana dashboard components</p>
</li>
<li>
<p><code>node-exporter</code> to place the node exporter components</p>
</li>
<li>
<p><code>prometheus</code> to place the Prometheus components</p>
</li>
<li>
<p><code>mgr</code> to place the Manager containers</p>
</li>
<li>
<p><code>mon</code> to place the Monitor containers</p>
</li>
<li>
<p><code>osd</code> to place the OSD containers</p>
</li>
<li>
<p><code>rgw</code> to place the RADOS Gateway containers</p>
</li>
<li>
<p><code>mds</code> to place the MDS containers</p>
</li>
<li>
<p><code>ingress</code> to place the loadbalancer (haproxy)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Available services also include <code>nfs</code> and <code>iscsi</code>. They are not covered
in this documentation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For troubleshooting or tuning you can pass additional parameters to the
container upong startup. See example below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Add container parameters</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">extra_container_args:
  -  "--cpus=2"</code></pre>
</div>
</div>
<div class="paragraph">
<p>To assign labels to one or more hosts, use the following syntax:</p>
</div>
<div class="listingblock">
<div class="title">Labelling nodes example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: host
addr: {host_address}
hostname: {host_name}
labels:
- xxx
- yyy
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can set the initial CRUSH location of the node using the <code>location</code>
keyword.  See example below.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">CRUSH location setting</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">location:
  rack: rack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>To assign a service to one or more nodes use the following syntax:</p>
</div>
<div class="listingblock">
<div class="title">Assigning a service example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: {service_type}
service_name: {service_name}
placement:
  host_pattern: ‘*’</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OSD service file accepts additional parameters due to the complexity of
OSD deployments based on drive types. The additional parameters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>block_db_size</code> to specify the RocksDB size on separate devices</p>
</li>
<li>
<p><code>block_wal_size</code> to specify the RocksDB size on separate devices</p>
</li>
<li>
<p><code>data_devices</code> to specify which devices will receive the data</p>
</li>
<li>
<p><code>db_devices</code> to specify which devices will receive RocksDB DB portion</p>
</li>
<li>
<p><code>wal_devices</code> to specify which devices will receive the RocksDB WAL portion</p>
</li>
<li>
<p><code>db_slots</code> to specify how many RocksDB DB partition to allocate per <code>db_device</code></p>
</li>
<li>
<p><code>wal_slots</code> to specify how many RocksDB WAL partition to allocate per <code>wal_device</code></p>
</li>
<li>
<p><code>data_directories</code> to specify a list of device paths to be used</p>
</li>
<li>
<p><code>filter_logic</code> to specify <code>OR</code> or <code>AND</code> between filters. Default is <code>AND</code>.</p>
</li>
<li>
<p><code>objectstore</code> to specify the OSD backend type (<code>bluestore</code> or <code>filestore</code>)</p>
</li>
<li>
<p><code>crush_device_class</code> to specify the CRUSH device class</p>
</li>
<li>
<p><code>data_allocate_fraction</code> to specify a portion of the drive for data devices (between <code>0</code> and <code>1.0</code>)</p>
</li>
<li>
<p><code>osds_per_device</code> to specify how many OSDs should be deployed per device (default is 1)</p>
</li>
<li>
<p><code>osd_id_claims</code> to specify the OSD ids should be repserved per node (<code>true</code> or <code>false</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>data_devices</code>, <code>db_devices</code> and <code>wal_devices</code> parameters accept the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>all</code> to specifcy all devices are to be consumed (<code>true</code> or <code>false</code>)</p>
</li>
<li>
<p><code>limit</code> to specify how many OSD are to be deployed per node</p>
</li>
<li>
<p><code>rotational</code> to specify the type of devices to select (<code>0</code> or <code>1</code>)</p>
</li>
<li>
<p><code>size</code> to specify the size of the devices to select</p>
<div class="ulist">
<ul>
<li>
<p><code>xTB</code> to select a specific device size</p>
</li>
<li>
<p><code>xTB:yTB</code> to select devices between the two capacities</p>
</li>
<li>
<p><code>:xTB</code> to select any device up to this size</p>
</li>
<li>
<p><code>xTB:</code> to select any device at least this size</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>path</code> to specify the device path to use</p>
</li>
<li>
<p><code>model</code> to specify the disk model name</p>
</li>
<li>
<p><code>vendor</code> to specify the vendor model name</p>
</li>
<li>
<p><code>encrypted</code> to specify if the data is to be encrypted at rest (<code>data_devices</code> only)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>cephadm</code> also support FileStore parameters for specific cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The RADOS Gateway service service file accepts additional paraneters due
to the nature of the RADOS Gateway service. The additional parameters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>networks</code> to specify which CIDR the gateway will bind to</p>
</li>
<li>
<p><code>spec</code></p>
<div class="ulist">
<ul>
<li>
<p><code>rgw_frontend_port</code> to specify which the TCP port the gateway will bind</p>
</li>
<li>
<p><code>rgw_realm</code> to specify the <code>realm</code> for this gateway</p>
</li>
<li>
<p><code>rgw_zone</code> to specify the <code>zone</code> for this gateway</p>
</li>
<li>
<p><code>ssl</code> to specify if this gateway uses SSL (<code>true</code> or <code>false</code>)</p>
</li>
<li>
<p><code>rgw_frontend_ssl_certificate</code> to specify the certificate to use</p>
</li>
<li>
<p><code>rgw_frontend_ssl_key</code> to specify the key to use</p>
</li>
<li>
<p><code>rgw_frontend_type</code> to specify the frontend to use (default is <code>beast</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>placement.count_per_host</code> to specify how many RADOS Gateways are to be deployed per node</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can upload the certificate and the key to be use by the gateway via the<br>
<code>ceph config-key set rgw/cert/REALM_NAME/ZONE_NAME.crt -i {file}</code> and <br>
 <code>ceph config-key set rgw/cert/REALM_NAME/ZONE_NAME.key -i {file}</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more placement options see the next chapter.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cephadm_placement"><a class="anchor" href="#_cephadm_placement"></a><code>cephadm</code> placement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Placement can be a simple count to indicate the number of daemons to deploy. In such a
configuration <code>cephadm</code> will choose where to deploy the daemons.</p>
</div>
<div class="paragraph">
<p>Placement can use explicit naming: <code>--placement="host1 host2 &#8230;&#8203;"</code>. In such configuration
the daemons will be deployed on the nodes listed.</p>
</div>
<div class="paragraph">
<p>Placement can use labels: <code>--placement="label:mylabel"</code>. In such configuration the
daemons will be deployed on the nodes that match the provided label.</p>
</div>
<div class="paragraph">
<p>Placement can use expressions: <code>--placement="host[1-5]"</code>. In such configuration the
daemons will be deployed on the nodes that match the provided expression.</p>
</div>
<div class="paragraph">
<p>Using a service file, you would encode the following for count:</p>
</div>
<div class="listingblock">
<div class="title">Using the count syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: rgw
placement:
  count: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a service file, you would encode the following for label:</p>
</div>
<div class="listingblock">
<div class="title">Using the label syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: rgw
placement:
  label: "mylabel"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a service file, you would encode the following for host list:</p>
</div>
<div class="listingblock">
<div class="title">Using the list syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: rgw
placement:
  hosts:
    - host1
    - host2
    - host3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a service file, you would encode the following for pattern:</p>
</div>
<div class="listingblock">
<div class="title">Using host pattern syntax</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">service_type: rgw
placement:
  host_pattern: "host[1-5]"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The count argument can be added to <code>hosts</code>, <code>label</code> and <code>host_pattern</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add <code>unmanaged: true</code> to your service file to instruct <code>cephadm</code>
to not automatically manage the service described in the service file.
Deployment and removal of the specified service will have to be managed
manually by the storage administrator.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
      <img src="../../_/img/header_logo.svg" alt="Ceph">
  </a>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
